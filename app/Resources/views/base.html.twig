{% if app.request.locale == 'fr' %}
    {% set date_format = 'd-m-Y' %}
{% else %}
    {% set date_format = 'm-d-Y' %}
{% endif %}
<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>{{ 'global.project_crm'|trans }}</title>
        
        {% set dir = 'backoffice/' %}
        <link rel="icon" type="image/x-icon" href="{{ asset('favicon.ico') }}" />
        {% block stylesheets %}
        <!-- Global stylesheets -->
        <link href="https://fonts.googleapis.com/css?family=Roboto:400,300,100,500,700,900" rel="stylesheet" type="text/css" />
        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
        <link href="{{ asset('assets/' ~ dir ~'css/icons/icomoon/styles.css') }}" rel="stylesheet" type="text/css"/>
        <link href="{{ asset('assets/' ~ dir ~'css/bootstrap.css') }}" rel="stylesheet" type="text/css"/>
        <link href="{{ asset('assets/' ~ dir ~'css/core.css') }}" rel="stylesheet" type="text/css"/>
        <link href="{{ asset('assets/' ~ dir ~'css/components.css') }}" rel="stylesheet" type="text/css"/>
        <link href="{{ asset('assets/' ~ dir ~'css/colors.css') }}" rel="stylesheet" type="text/css"/>
        <link href="{{ asset('assets/' ~ dir ~'css/fileinput.min.css') }}" rel="stylesheet" type="text/css"/>
        <style type="text/css">
            .datepicker, .ui-datepicker { z-index: 99999 !important }
        </style>
        <!-- /global stylesheets -->
        {% endblock %}
        {% block javascripts %}
            <script type="text/javascript">
                var base_url = '{{ absolute_url('/') }}';
            </script>
            <!-- Core JS files -->
            <script type="text/javascript" src="{{ asset('assets/' ~ dir ~'js/plugins/loaders/pace.min.js') }}"></script>
            <script type="text/javascript" src="{{ asset('assets/' ~ dir ~'js/core/libraries/jquery.min.js') }}"></script>
            <script type="text/javascript" src="{{ asset('assets/' ~ dir ~'js/core/libraries/bootstrap.min.js') }}"></script>
            <script type="text/javascript" src="{{ asset('assets/' ~ dir ~'js/plugins/loaders/blockui.min.js') }}"></script>
            <!-- /core JS files -->

            <!-- Theme JS files -->
            <script type="text/javascript" src="{{ asset('assets/' ~ dir ~'js/plugins/visualization/d3/d3.min.js') }}"></script>
            <script type="text/javascript" src="{{ asset('assets/' ~ dir ~'js/plugins/visualization/d3/d3_tooltip.js') }}"></script>
            <script type="text/javascript" src="{{ asset('assets/' ~ dir ~'js/plugins/forms/styling/switchery.min.js') }}"></script>
            <script type="text/javascript" src="{{ asset('assets/' ~ dir ~'js/plugins/forms/styling/uniform.min.js') }}"></script>
            <script type="text/javascript" src="{{ asset('assets/' ~ dir ~'js/plugins/forms/selects/bootstrap_multiselect.js') }}"></script>
            <script type="text/javascript" src="{{ asset('assets/' ~ dir ~'js/plugins/ui/moment/moment.min.js') }}"></script>
            <script type="text/javascript" src="{{ asset('assets/' ~ dir ~'js/plugins/pickers/daterangepicker.js') }}"></script>
            <script type="text/javascript" src="{{ asset('assets/' ~ dir ~'js/plugins/ui/nicescroll.min.js') }}"></script>
            <script type="text/javascript" src="{{ asset('assets/' ~ dir ~'js/plugins/ui/drilldown.js') }}"></script>
            {# // <script type="text/javascript" src="{{ asset('assets/' ~ dir ~'js/plugins/forms/selects/selectboxit.min.js') }}"></script> #}

            <script type="text/javascript" src="{{ asset('assets/' ~ dir ~'js/core/libraries/jquery_ui/interactions.min.js') }}"></script>
            <script type="text/javascript" src="{{ asset('assets/' ~ dir ~'js/core/libraries/jquery_ui/widgets.min.js') }}"></script>
            <script type="text/javascript" src="{{ asset('assets/' ~ dir ~'js/core/libraries/jquery_ui/effects.min.js') }}"></script>

            <script type="text/javascript" src="{{ asset('assets/' ~ dir ~'js/core/app.js') }}"></script>
            <script type="text/javascript" src="{{ asset('assets/' ~ dir ~'js/pages/jqueryui_forms.js') }}"></script>
            <script type="text/javascript" src="{{ asset('assets/' ~ dir ~'js/plugins/tables/datatables/datatables.min.js') }}"></script>
            <script type="text/javascript" src="{{ asset('assets/' ~ dir ~'js/plugins/forms/wizards/steps.min.js') }}"></script>
            <script type="text/javascript" src="{{ asset('assets/' ~ dir ~'js/plugins/pickers/color/spectrum.js') }}"></script>
            <script type="text/javascript" src="{{ asset('assets/' ~ dir ~'js/plugins/uploaders/fileinput/fileinput.min.js') }}"></script>
            <script type="text/javascript" src="{{ asset('assets/' ~ dir ~'js/plugins/notifications/pnotify.min.js') }}"></script>
            <script type="text/javascript" src="{{ asset('assets/' ~ dir ~'js/plugins/notifications/noty.min.js') }}"></script>
            <script type="text/javascript" src="{{ asset('assets/' ~ dir ~'js/plugins/notifications/jgrowl.min.js') }}"></script>
            <script type="text/javascript" src="{{ asset('assets/' ~ dir ~'js/plugins/pickers/anytime.min.js') }}"></script>
            <script type="text/javascript" src="{{ asset('assets/' ~ dir ~'js/plugins/forms/selects/select2.min.js') }}"></script>
            <script type="text/javascript" src="{{ asset('assets/' ~ dir ~'js/plugins/forms/styling/switchery.min.js') }}"></script>
            <!-- /theme JS files -->
            <script type="text/javascript">
                function redirectTo($url) {
                    if( $url )
                        document.location.href = $url;
                }
                
                (function($){
                    $(function() {
                        $('#password').attr('type', 'password');  
                    });
                }(jQuery));
            </script>
        {% endblock %}
    </head>
    
    <!-- the body -->
     <body class="">
        {% block header %}
            <div class="container">
                {% set notify = notify()|trans %}
                {% if notify %}
                {# <div class="alert alert-styled-left" style="margin-top: 20px" type="success" data-layout="topLeft">
                    <i class="icon-checkmark3" style="padding-right: 15px"></i>{{ notify }}
                </div> #}
                <script type="text/javascript">
                	(function($){
                		$(function(){
                			new PNotify({
					            title: 'Notification',
					            text: '{{ notify }}',
					            icon: 'icon-checkmark3',
					            type: 'success'
					        });
                		});
                	}(jQuery))
                </script>
                {% endif %}
            </div>
            <div id="modal_remote" class="modal">
                <div class="modal-dialog modal-full">
                    <div class="modal-content">
                    </div>
                </div>
            </div>
        {% endblock %}
        {% block body %}{% endblock %}
        {% block footer %}{% endblock %}
        <script type="text/javascript">
            (function($){
                try {
                    var cookie_lifetime = {{ getCookieLife() }};
                    var page = window.page = function(url) { 
                        this.time = 0;
                        this.timeInterval = null;
                        this.delay = 1000;
                        this.url = url;
                    };
                    // count
                    page.prototype.count = function() {
                        if( this.time >= (cookie_lifetime - 4) ) {
                            var alert = $('.alert').removeClass('hidden').addClass('alert-warning');
                                alert.find('div').addClass('text-semibold').html("{{ 'global.timeout'|trans }}");
                        }

                        if( this.time >= cookie_lifetime ) { // 1 hour rendre dynamique
                            this.stop();
                            
                            redirectTo('{{ path('fos_user_security_logout') }}');
                        }
                        console.info(this.time);
                        this.time++;
                    };
                    // start
                    page.prototype.start = function() {
                        this.timeInterval = setInterval(this.count.bind(this), this.delay);
                    };
                    // stop
                    page.prototype.stop = function() { 
                        clearInterval(this.timeInterval);
                        this.timeInterval = null;
                        this.time = 0;
                    };
                }catch(e){console.info(e)}
            }(jQuery))
        </script>
        <script type="text/javascript">
            var _page = new page('{{ path('fos_user_security_logout') }}');
            document.body.onblur = function(){
                _page.start();
            };
            document.body.onfocus = function() {
                _page.stop();
            };

            try {

                $(document).on('submit', function(){
                    $('.datepicker').each(function(){
                        if( !this.value ) $(this).attr('placeholder', '0000-00-00');
                        $(this).val($(this).attr('placeholder'));
                    });
                });

                $('a[data-action="close"]').on('click', function(e) {
                    e.preventDefault();
                    redirectTo(this.href);
                });
            }catch(e){console.warn(e)}

            (function($){
                try {
                    $(".colorpicker-show-input").each(function(){
                        var color = this.value ? this.value : '#000000';
                        $(this).spectrum({
                            preferredFormat: "hex",
                            showInput: true,
                            color: color
                        })
                    });
                }catch(e){console.info(e)}
                try {
                    var old_value, array = {};
                    $('[name*="[label]"]')
                        .on('keypress', function(){
                            old_value = this.value;
                        })
                        .on('keyup, blur', function() {
                            $('[name*="[%s]"]'.replace('%s', lang_tab[lang])).val(this.value);
                            var self = this;
                            $('[name*="lib"]').each(function(){
                                if( this == self ) return;
                                var is = false;
                                if( typeof array[$(this).attr('name')] !== 'undefined' )
                                    is = true;
                                if( !is && this.value.length ) return;
                                if( !this.value.length ) array[$(this).attr('name')] =  true;

                                this.value = self.value;
                            });
                        });
                    $('[name*="[descriptionPerimetres]"]')
                        .on('keypress', function(){
                            old_value = this.value;
                        })
                        .on('keyup, blur', function() {
                            $('[name*="[%s]"]'.replace('%s', desc_tab[lang])).val(this.value);
                            var self = this;
                            $('[name*="descriptionPerimetre"]').each(function(){
                                if( this == self ) return;
                                var is = false;
                                if( typeof array[$(this).attr('name')] !== 'undefined' )
                                    is = true;
                                if( !is && this.value.length ) return;
                                if( !this.value.length ) array[$(this).attr('name')] =  true;

                                this.value = self.value;
                            });
                        });
                }catch(e){console.info(e)}
                try {
                    // alert(bSort);
                    var table = $('.datatable-basic').DataTable({
                        searching: typeof searching != 'undefined' ? searching : true,
                        paging: typeof paging != 'undefined' ? paging : true,
                        orderCellsTop: true,
                        dom: '<"datatable-header"fl><"datatable-scroll"t><"datatable-footer"ip>',
                        language: {
                            search: '',
                            searchPlaceholder: '{{ 'global.search'|trans }}',
                            lengthMenu: '<span>{{ 'global.show'|trans }}</span> _MENU_',
                            info: '{{ 'global._START_of_END_/_TOTAL_entries'|trans }}',
                            emptyTable: '{{ 'global.no_data'|trans }}',
                            paginate: {
                                first:      '{{ 'global.pagination_first'|trans }}',
                                previous:   '{{ 'global.pagination_previous'|trans }}',
                                next:       '{{ 'global.pagination_next'|trans }}',
                                last:       '{{ 'global.pagination_last'|trans }}'
                            }
                        },
                        stateSave: true,
                        bSort: typeof bSort !== 'undefined' ? bSort : true,
                        columnDefs: [{ targets: 'no-sort', orderable: false }],
                        initComplete: typeof initComplete !== 'undefined' ? initComplete : function() {}
                    });

                    /*Enable Select2 select for individual column searching*/
                    $('.filter-select').select2({ minimumResultsForSearch: Infinity, containerCssClass: 'select-xs' });

                }catch(e){console.warn(e)}
                try{
                    /* chargement des donnée dynmique via modal jQuery */
                    $('#modal_remote').on('show.bs.modal', function(args) {
                        /* supprimer avant */
                        $(this).find('.modal-content *').remove();
                        /* charge après */
                        var el = args.relatedTarget;
                        if( (href = $(el).attr('href')) )
                            $(this).find('.modal-content').load(href, function() {});
                    });
                }catch(e){console.warn(e)}
                try{
                    $('.upload-file').each(function(){
                        var input = $('.upload-file').each(function(){
                            var preview = $(this).attr('data-preview');
                            var filetype = $(this).attr('filetype');
                            var filename = '';
                            if( preview != null ) {
                                filename = preview.toString().split('/');
                                filename = filename[filename.length-1];
                            }

                            $(this).fileinput({
                                browseLabel: '{{'global.browse'|trans}}',
                                overwriteInitial: true,
                                initialCaption: filename ? filename : '{{'global.no_file'|trans}}',
                                initialPreview: preview,
                                initialPreviewAsData: true, // defaults markup
                                // initialPreviewFileType: 'image', // image is the default and can be overridden in config below
                                initialPreviewConfig: preview ? [{filename: preview, caption: filename, filetype: filetype}] : [],
                                preferIconicPreview: true, 
                                // allowedPreviewTypes: null,
                                layoutTemplates: {
                                    icon: '<i class="icon-file-check"></i>',
                                    main1: "{preview}\n" +
                                        "<div class='input-group {class}'>\n" +
                                        "   {caption}\n" +
                                        "   <div class='input-group-btn'>\n" +
                                        "       {browse}\n" +
                                        "   </div>\n" +
                                        "</div>",
                                    actionDownload: '<a href="{downloadUrl}" class="{downloadClass}" title="{downloadTitle}" ' + 'download="{caption}">{downloadIcon}</a>\n',
                                },
                                previewFileIconSettings: { 
                                    'doc': '<i class="fa fa-file-word-o text-primary"></i>',
                                    'xls': '<i class="fa fa-file-excel-o text-success"></i>',
                                    'ppt': '<i class="fa fa-file-powerpoint-o text-danger"></i>',
                                    'pdf': '<i class="fa fa-file-pdf-o text-danger"></i>',
                                    'zip': '<i class="fa fa-file-archive-o text-muted"></i>',
                                    'htm': '<i class="fa fa-file-code-o text-info"></i>',
                                    'txt': '<i class="fa fa-file-text-o text-info"></i>',
                                    'mov': '<i class="fa fa-file-movie-o text-warning"></i>',
                                    'mp3': '<i class="fa fa-file-audio-o text-warning"></i>'   
                                },
                                previewFileExtSettings: { 
                                    'doc': function(ext) {
                                        return ext.match(/(doc|docx)$/i);
                                    },
                                    'xls': function(ext) {
                                        return ext.match(/(xls|xlsx)$/i);
                                    },
                                    'ppt': function(ext) {
                                        return ext.match(/(ppt|pptx)$/i);
                                    },
                                    'zip': function(ext) {
                                        return ext.match(/(zip|rar|tar|gzip|gz|7z)$/i);
                                    },
                                    'htm': function(ext) {
                                        return ext.match(/(htm|html)$/i);
                                    },
                                    'txt': function(ext) {
                                        return ext.match(/(txt|ini|csv|java|php|js|css)$/i);
                                    },
                                    'mov': function(ext) {
                                        return ext.match(/(avi|mpg|mkv|mov|mp4|3gp|webm|wmv)$/i);
                                    },
                                    'mp3': function(ext) {
                                        return ext.match(/(mp3|wav)$/i);
                                    }
                                }
                            }).on('filesorted', function(e, params) {
                                console.log('File sorted params', params);
                            }).on('fileuploaded', function(e, params) {
                                console.log('File uploaded params', params);
                            }).on('filezoomshow', function(event, params) {
                                console.log('File zoom show ', params.sourceEvent, params.previewId, params.modal);
                            });
                        });

                        input.on('filecleared', function(event) {
                            var submit = $(event.target).parents('form').find('[type="submit"]');
                                submit.val( submit.val() + ',' + event.target.name);
                        })
                        .on('fileselect', function(event){
                            var submit = $(event.target).parents('form').find('[type="submit"]');
                                submit.val( submit.val().toString().replace(',' + event.target.name, '') );
                        });

                    });
                }catch(e){console.warn(e)}
                try{
                    (function($){
                        $('.switchery').each(function(){
                            var switchery = new Switchery(this);    
                        })
                    }(jQuery));

                    // datepicker
                    var date_format = '{{ date_format }}'.toLowerCase();
                    date_format = window.date_format = date_format.replace('d', 'dd').replace('m','mm').replace('y', 'yy');

                    /* datepicker */
                    $('.datepicker').each(function(){
                        if( !this.value ) return $(this).attr('placeholder', 'Format: ' + date_format);
                        var date = this.value.replace(/-/g,'/');
                        if( date.indexOf('/') == 0 || date.indexOf('-') == 0 || 
                            date.indexOf('0000') != -1 || date.indexOf('0001') != -1 ) {
                            $(this).attr('placeholder', 'Format: ' + date_format);
                            $(this).val('');
                            return;
                        }

                        //  default value
                        $(this).attr('placeholder', date); 

                        // visual value
                       $(this).val($.datepicker.formatDate(date_format, new Date(this.value)));
                    });

                    $('.datepicker').datepicker({
                        onSelect: function(date){
                            var val = this.value;
                            // default value
                            $(this).attr('placeholder', val); 

                            // visual value
                            $(this).val($.datepicker.formatDate(date_format, new Date(val)));
                        }
                    });

                    $('.anytime-both').each(function() {
                        var val = $(this).val();
                        $(this).attr('placeholder', val);

                        // format pour placeholder
                        // format programme
                        var date_format_placeholder = 'MM-DD-YYYY H:mm';

                        // format pour value
                        // format visuel
                        var date_format_value = date_format_placeholder;// .toString().replace('yy', 'yyyy').toUpperCase() + ' H:mm';

                        $(this).daterangepicker({
                            timePicker: true,
                            applyClass: 'bg-slate-600',
                            cancelClass: 'btn-default',
                            locale: {
                                format: date_format_value
                            },
                        }).on('change.daterangepicker', function() {
                            // alert(this.value);
                            var val = $(this).val();
                            // console.info($.daterangepicker.format());
                        });
                    });

                }catch(e){console.warn(e)}

                // pour les formulaires
                try {

                    $('*[required="required"]').each(function(){
                        $(this).removeAttr('required');
                        $(this).attr('form-required', true);

                        $(this).on('focus', function(){
                            $(this).removeAttr('style');
                        });
                    });

                    $('form').on('submit', function(e){
                        // les elements
                        var element = $('[form-required="true"]');
                        var _true = false;
                        if( !element.length ) return;
                        
                        element.each(function(){
                            // falg
                            var _true = false;
                            // text
                            if( $(this).val() == 0 ) _true = true;
                            // pour les texts 
                            if( $(this).val() == "" ) _true = true;

                             // pour les texts 
                            if( _true ) {
                                var label = $(this).parents('.form-group').find('label').html();
                                alert("{{ 'project.form_null'|trans({}, 'project') }} " + label);
                                // border
                                $(this).css('border-bottom-color', 'red');
                                $(this).focus();
                                e.preventDefault();
                                // on arrête
                                return false;
                            }
                        });

                        // pour les element disabled 
                        $('[disabled="disabled"]').removeAttr('disabled');
                    });

                }catch(e) {}

                // select
                $('.select2-search').select2();
            }(jQuery));
        </script>
    </body>
</html>
